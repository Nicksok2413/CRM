{% extends "_base.html" %}

{% block content %}
<h2 class="fw-bold">Лиды</h2>
<div class="row bg-white px-3 py-3 mx-2 my-5 rounded pb-5 shadow-lg">
    <div class="hstack gap-3 pb-4">
        {% if perms.leads.add_potentialclient %}
        <a href="{% url 'leads:create' %}" class="btn btn-success p-2">Создать</a>
        {% endif %}
    </div>
    <div class="col">
        <ul class="list-group">
            {% for lead in leads %}
            <li class="list-group-item list-group-item-light d-flex justify-content-between">
                <a href="{% url 'leads:detail' lead.pk %}" class="text-decoration-none link-dark">{{ lead.last_name }} {{ lead.first_name }}</a>
                <div class="d-flex gap-2">
                    <!-- ================= НОВЫЙ БЛОК ================= -->
                    <!-- Проверяем, может ли пользователь создавать Активных клиентов -->
                    {% if perms.customers.add_activeclient %}
                        <!-- Проверяем, не является ли этот лид уже активным клиентом -->
                        {% if not lead.active_client_status or lead.active_client_status.is_deleted %}
                            <a href="{% url 'customers:create_from_lead' lead.pk %}" class="btn btn-info btn-sm">Активировать</a>
                        {% else %}
                            <span class="badge bg-success">Активный клиент</span>
                        {% endif %}
                    {% endif %}
                    <!-- ============================================== -->

                    {% if perms.leads.delete_potentialclient %}
                    <a href="{% url 'leads:delete' lead.pk %}" class="btn btn-danger btn-sm">Удалить</a>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}